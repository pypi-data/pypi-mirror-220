[tox]
envlist = py{38,39,310,311},qa,docs
skip_missing_interpreters = true
isolated_build = true

[testenv]
allowlist_externals = pdm
setenv =
    PDM_IGNORE_SAVED_PYTHON="1"
    PYTHONPATH=""
    MODULE_PATH="src/flufl/lock"
    MODULE_NAME="flufl.lock"
passenv =
commands =
    pdm install -G testing
    pytest {posargs}
    # The following is only useful in a git repository.
    -diff-cover coverage.xml
usedevelop = true

[testenv:qa]
commands =
    pdm install -G qa
    ruff check {env:MODULE_PATH}
    blue --check {env:MODULE_PATH}
    mypy -p {env:MODULE_NAME}

[testenv:fixit]
commands =
    pdm install -G qa
    ruff check --fix {env:MODULE_PATH}
    blue {env:MODULE_PATH}

[testenv:docs]
commands =
    pdm install -G docs
    sphinx-build docs build/html
