(()=>{var le=Object.create;var P=Object.defineProperty;var ce=Object.getOwnPropertyDescriptor;var ue=Object.getOwnPropertyNames;var de=Object.getPrototypeOf,fe=Object.prototype.hasOwnProperty;var he=t=>P(t,"__esModule",{value:!0});var pe=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var me=(t,e,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of ue(e))!fe.call(t,a)&&a!=="default"&&P(t,a,{get:()=>e[a],enumerable:!(n=ce(e,a))||n.enumerable});return t},_e=t=>me(he(P(t!=null?le(de(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var V=pe(G=>{(function(t,e){typeof define=="function"&&define.amd?define([],e):t.Idiomorph=t.Idiomorph||e()})(typeof self!="undefined"?self:G,function(){return function(){"use strict";let t=new Set;function e(r,o,i={}){r instanceof Document&&(r=r.documentElement),typeof o=="string"&&(o=Z(o));let l=ee(o),c=R(r,l,i);return n(r,l,c)}function n(r,o,i){if(i.head.block){let l=r.querySelector("head"),c=o.querySelector("head");if(l&&c){let u=h(c,l,i);Promise.all(u).then(function(){n(r,o,Object.assign(i,{head:{block:!1,ignore:!0}}))});return}}if(i.morphStyle==="innerHTML")return s(o,r,i),r.children;if(i.morphStyle==="outerHTML"||i.morphStyle==null){let l=ne(o,r,i),c=l?.previousSibling,u=l?.nextSibling,p=a(r,l,i);return l?te(c,p,u):[]}else throw"Do not understand how to morph style "+i.morphStyle}function a(r,o,i){if(!(i.ignoreActive&&r===document.activeElement))return o==null?(i.callbacks.beforeNodeRemoved(r),r.remove(),i.callbacks.afterNodeRemoved(r),null):E(r,o)?(i.callbacks.beforeNodeMorphed(r,o),r instanceof HTMLHeadElement&&i.head.ignore||(r instanceof HTMLHeadElement&&i.head.style!=="morph"?h(o,r,i):(d(o,r),s(o,r,i))),i.callbacks.afterNodeMorphed(r,o),r):(i.callbacks.beforeNodeRemoved(r),i.callbacks.beforeNodeAdded(o),r.parentElement.replaceChild(o,r),i.callbacks.afterNodeAdded(o),i.callbacks.afterNodeRemoved(r),o)}function s(r,o,i){let l=r.firstChild,c=o.firstChild;for(;l;){let u=l;if(l=u.nextSibling,c==null)i.callbacks.beforeNodeAdded(u),o.appendChild(u),i.callbacks.afterNodeAdded(u);else if(T(u,c,i))a(c,u,i),c=c.nextSibling;else{let p=x(r,o,u,c,i);if(p)c=w(c,p,i),a(p,u,i);else{let y=X(r,o,u,c,i);y?(c=w(c,y,i),a(y,u,i)):(i.callbacks.beforeNodeAdded(u),o.insertBefore(u,c),i.callbacks.afterNodeAdded(u))}}N(i,u)}for(;c!==null;){let u=c;c=c.nextSibling,q(u,i)}}function d(r,o){let i=r.nodeType;if(i===1){let l=r.attributes,c=o.attributes;for(let u of l)o.getAttribute(u.name)!==u.value&&o.setAttribute(u.name,u.value);for(let u of c)r.hasAttribute(u.name)||o.removeAttribute(u.name)}if((i===8||i===3)&&o.nodeValue!==r.nodeValue&&(o.nodeValue=r.nodeValue),r instanceof HTMLInputElement&&o instanceof HTMLInputElement&&r.type!=="file"){let l=r.value,c=o.value;f(r,o,"checked"),f(r,o,"disabled"),r.hasAttribute("value")?l!==c&&(o.setAttribute("value",l),o.value=l):(o.value="",o.removeAttribute("value"))}else if(r instanceof HTMLOptionElement)f(r,o,"selected");else if(r instanceof HTMLTextAreaElement&&o instanceof HTMLTextAreaElement){let l=r.value,c=o.value;l!==c&&(o.value=l),o.firstChild&&o.firstChild.nodeValue!==l&&(o.firstChild.nodeValue=l)}}function f(r,o,i){r[i]!==o[i]&&(o[i]=r[i],r[i]?o.setAttribute(i,""):o.removeAttribute(i))}function h(r,o,i){let l=[],c=[],u=[],p=[],y=i.head.style,S=new Map;for(let _ of r.children)S.set(_.outerHTML,_);for(let _ of o.children){let v=S.has(_.outerHTML),C=i.head.shouldReAppend(_),I=i.head.shouldPreserve(_);v||I?C?c.push(_):(S.delete(_.outerHTML),u.push(_)):y==="append"?C&&(c.push(_),p.push(_)):i.head.shouldRemove(_)!==!1&&c.push(_)}p.push(...S.values()),m("to append: ",p);let F=[];for(let _ of p){m("adding: ",_);let v=document.createRange().createContextualFragment(_.outerHTML).firstChild;if(m(v),i.callbacks.beforeNodeAdded(v)!==!1){if(v.href||v.src){let C=null,I=new Promise(function(ae){C=ae});v.addEventListener("load",function(){C()}),F.push(I)}o.appendChild(v),i.callbacks.afterNodeAdded(v),l.push(v)}}for(let _ of c)i.callbacks.beforeNodeRemoved(_)!==!1&&(o.removeChild(_),i.callbacks.afterNodeRemoved(_));return i.head.afterHeadMorphed(o,{added:l,kept:u,removed:c}),F}function m(){}function b(){}function R(r,o,i){return{target:r,newContent:o,config:i,morphStyle:i.morphStyle,ignoreActive:i.ignoreActive,idMap:se(r,o),deadIds:new Set,callbacks:Object.assign({beforeNodeAdded:b,afterNodeAdded:b,beforeNodeMorphed:b,afterNodeMorphed:b,beforeNodeRemoved:b,afterNodeRemoved:b},i.callbacks),head:Object.assign({style:"merge",shouldPreserve:function(l){return l.getAttribute("im-preserve")==="true"},shouldReAppend:function(l){return l.getAttribute("im-re-append")==="true"},shouldRemove:b,afterHeadMorphed:b},i.head)}}function T(r,o,i){return r==null||o==null?!1:r.nodeType===o.nodeType&&r.tagName===o.tagName?r.id!==""&&r.id===o.id?!0:k(i,r,o)>0:!1}function E(r,o){return r==null||o==null?!1:r.nodeType===o.nodeType&&r.tagName===o.tagName}function w(r,o,i){for(;r!==o;){let l=r;r=r.nextSibling,q(l,i)}return N(i,o),o.nextSibling}function x(r,o,i,l,c){let u=k(c,i,o),p=null;if(u>0){let y=l,S=0;for(;y!=null;){if(T(i,y,c))return y;if(S+=k(c,y,r),S>u)return null;y=y.nextSibling}}return p}function X(r,o,i,l,c){let u=l,p=i.nextSibling,y=0;for(;u!=null;){if(k(c,u,r)>0)return null;if(E(i,u))return u;if(E(p,u)&&(y++,p=p.nextSibling,y>=2))return null;u=u.nextSibling}return u}function Z(r){let o=new DOMParser,i=r.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(i.match(/<\/html>/)||i.match(/<\/head>/)||i.match(/<\/body>/)){let l=o.parseFromString(r,"text/html");if(i.match(/<\/html>/))return l.generatedByIdiomorph=!0,l;{let c=l.firstChild;return c?(c.generatedByIdiomorph=!0,c):null}}else{let c=o.parseFromString("<body><template>"+r+"</template></body>","text/html").body.querySelector("template").content;return c.generatedByIdiomorph=!0,c}}function ee(r){if(r==null)return document.createElement("div");if(r.generatedByIdiomorph)return r;if(r instanceof Node){let o=document.createElement("div");return o.append(r),o}else{let o=document.createElement("div");for(let i of[...r])o.append(i);return o}}function te(r,o,i){let l=[],c=[];for(;r!=null;)l.push(r),r=r.previousSibling;for(;l.length>0;){let u=l.pop();c.push(u),o.parentElement.insertBefore(u,o)}for(c.push(o);i!=null;)l.push(i),c.push(i),i=i.nextSibling;for(;l.length>0;)o.parentElement.insertBefore(l.pop(),o.nextSibling);return c}function ne(r,o,i){let l;l=r.firstChild;let c=l,u=0;for(;l;){let p=re(l,o,i);p>u&&(c=l,u=p),l=l.nextSibling}return c}function re(r,o,i){return E(r,o)?.5+k(i,r,o):0}function q(r,o){N(o,r),o.callbacks.beforeNodeRemoved(r),r.remove(),o.callbacks.afterNodeRemoved(r)}function oe(r,o){return!r.deadIds.has(o)}function ie(r,o,i){return(r.idMap.get(i)||t).has(o)}function N(r,o){let i=r.idMap.get(o)||t;for(let l of i)r.deadIds.add(l)}function k(r,o,i){let l=r.idMap.get(o)||t,c=0;for(let u of l)oe(r,u)&&ie(r,u,i)&&++c;return c}function U(r,o){let i=r.parentElement,l=r.querySelectorAll("[id]");for(let c of l){let u=c;for(;u!==i&&u!=null;){let p=o.get(u);p==null&&(p=new Set,o.set(u,p)),p.add(c.id),u=u.parentElement}}}function se(r,o){let i=new Map;return U(r,i),U(o,i),i}return{morph:e}}()})});var D=function(t,e){return D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var s in a)a.hasOwnProperty(s)&&(n[s]=a[s])},D(t,e)};function B(t,e){D(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function ye(t){var e=typeof Symbol=="function"&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function be(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var a=n.call(t),s,d=[],f;try{for(;(e===void 0||e-- >0)&&!(s=a.next()).done;)d.push(s.value)}catch(h){f={error:h}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(f)throw f.error}}return d}function ge(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(be(arguments[e]));return t}var W=function(){function t(e,n){this.target=n,this.type=e}return t}(),ve=function(t){B(e,t);function e(n,a){var s=t.call(this,"error",a)||this;return s.message=n.message,s.error=n,s}return e}(W),Ee=function(t){B(e,t);function e(n,a,s){n===void 0&&(n=1e3),a===void 0&&(a="");var d=t.call(this,"close",s)||this;return d.wasClean=!0,d.code=n,d.reason=a,d}return e}(W);var we=function(){if(typeof WebSocket!="undefined")return WebSocket},Se=function(t){return typeof t!="undefined"&&!!t&&t.CLOSING===2},L={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},Le=function(){function t(e,n,a){var s=this;a===void 0&&(a={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(d){s._debug("open event");var f=s._options.minUptime,h=f===void 0?L.minUptime:f;clearTimeout(s._connectTimeout),s._uptimeTimeout=setTimeout(function(){return s._acceptOpen()},h),s._ws.binaryType=s._binaryType,s._messageQueue.forEach(function(m){return s._ws.send(m)}),s._messageQueue=[],s.onopen&&s.onopen(d),s._listeners.open.forEach(function(m){return s._callEventListener(d,m)})},this._handleMessage=function(d){s._debug("message event"),s.onmessage&&s.onmessage(d),s._listeners.message.forEach(function(f){return s._callEventListener(d,f)})},this._handleError=function(d){s._debug("error event",d.message),s._disconnect(void 0,d.message==="TIMEOUT"?"timeout":void 0),s.onerror&&s.onerror(d),s._debug("exec error listeners"),s._listeners.error.forEach(function(f){return s._callEventListener(d,f)}),s._connect()},this._handleClose=function(d){s._debug("close event"),s._clearTimeouts(),s._shouldReconnect&&s._connect(),s.onclose&&s.onclose(d),s._listeners.close.forEach(function(f){return s._callEventListener(d,f)})},this._url=e,this._protocols=n,this._options=a,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(t,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CONNECTING",{get:function(){return t.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"OPEN",{get:function(){return t.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CLOSING",{get:function(){return t.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CLOSED",{get:function(){return t.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferedAmount",{get:function(){var e=this._messageQueue.reduce(function(n,a){return typeof a=="string"?n+=a.length:a instanceof Blob?n+=a.size:n+=a.byteLength,n},0);return e+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?t.CLOSED:t.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),t.prototype.close=function(e,n){if(e===void 0&&(e=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(e,n)},t.prototype.reconnect=function(e,n){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(e,n),this._connect())},t.prototype.send=function(e){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",e),this._ws.send(e);else{var n=this._options.maxEnqueuedMessages,a=n===void 0?L.maxEnqueuedMessages:n;this._messageQueue.length<a&&(this._debug("enqueue",e),this._messageQueue.push(e))}},t.prototype.addEventListener=function(e,n){this._listeners[e]&&this._listeners[e].push(n)},t.prototype.dispatchEvent=function(e){var n,a,s=this._listeners[e.type];if(s)try{for(var d=ye(s),f=d.next();!f.done;f=d.next()){var h=f.value;this._callEventListener(e,h)}}catch(m){n={error:m}}finally{try{f&&!f.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}return!0},t.prototype.removeEventListener=function(e,n){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(function(a){return a!==n}))},t.prototype._debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._options.debug&&console.log.apply(console,ge(["RWS>"],e))},t.prototype._getNextDelay=function(){var e=this._options,n=e.reconnectionDelayGrowFactor,a=n===void 0?L.reconnectionDelayGrowFactor:n,s=e.minReconnectionDelay,d=s===void 0?L.minReconnectionDelay:s,f=e.maxReconnectionDelay,h=f===void 0?L.maxReconnectionDelay:f,m=0;return this._retryCount>0&&(m=d*Math.pow(a,this._retryCount-1),m>h&&(m=h)),this._debug("next delay",m),m},t.prototype._wait=function(){var e=this;return new Promise(function(n){setTimeout(n,e._getNextDelay())})},t.prototype._getNextUrl=function(e){if(typeof e=="string")return Promise.resolve(e);if(typeof e=="function"){var n=e();if(typeof n=="string")return Promise.resolve(n);if(n.then)return n}throw Error("Invalid URL")},t.prototype._connect=function(){var e=this;if(!(this._connectLock||!this._shouldReconnect)){this._connectLock=!0;var n=this._options,a=n.maxRetries,s=a===void 0?L.maxRetries:a,d=n.connectionTimeout,f=d===void 0?L.connectionTimeout:d,h=n.WebSocket,m=h===void 0?we():h;if(this._retryCount>=s){this._debug("max retries reached",this._retryCount,">=",s);return}if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!Se(m))throw Error("No valid WebSocket class provided");this._wait().then(function(){return e._getNextUrl(e._url)}).then(function(b){e._closeCalled||(e._debug("connect",{url:b,protocols:e._protocols}),e._ws=e._protocols?new m(b,e._protocols):new m(b),e._ws.binaryType=e._binaryType,e._connectLock=!1,e._addListeners(),e._connectTimeout=setTimeout(function(){return e._handleTimeout()},f))})}},t.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new ve(Error("TIMEOUT"),this))},t.prototype._disconnect=function(e,n){if(e===void 0&&(e=1e3),this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(e,n),this._handleClose(new Ee(e,n,this))}catch{}}},t.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},t.prototype._callEventListener=function(e,n){"handleEvent"in n?n.handleEvent(e):n(e)},t.prototype._removeListeners=function(){!this._ws||(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},t.prototype._addListeners=function(){!this._ws||(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},t.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},t}(),H=Le;var Ae=_e(V());function Q(t,e){Idiomorph.morph(t,e)}var j=JSON.parse(document.querySelector("meta[name=reactor-boost]")?.dataset.enabled||"false");console.log("BOOST_PAGES",j);var $=class extends EventTarget{sendNewLocation(){console.log("LOAD",document.location.href),this.dispatchEvent(new Event("newLocation"))}sendNewContent(){this.dispatchEvent(new Event("newContent"))}},O=new $;j&&document.addEventListener("click",t=>{let e=t.target;e=e.tagName.toLowerCase()!=="a"?e.closest("a"):e,e&&e.href&&(!e.target||e.target==="_self")&&e.origin==document.location.origin&&t.button===0&&!t.metaKey&&!t.ctrlKey&&!t.altKey&&!t.shiftKey&&(t.preventDefault(),M.load(e.href))});function J(t,e=void 0){window.requestAnimationFrame(()=>{Q(document.body,t),e===void 0?document.querySelector("[autofocus]")?.focus():window.scrollTo(0,e),O.sendNewContent()})}function ke(t){return t.startsWith("http://")||t.startsWith("https://")?new URL(t).origin===document.location.origin:!0}var M=class{static async load(e){j&&ke(e)?this.push(e):document.location.assign(e)}static back(){window.history.back()}static async push(e){if(document.body==null)debugger;history.replaceState({content:document.body.outerHTML,scrollY:window.scrollY},document.title,document.location.href),history.pushState({},document.title,e),this.replaceContentFromUrl(e)}static async replaceContentFromUrl(e){O.sendNewLocation();let a=await(await fetch(e)).text(),s=new DOMParser().parseFromString(a,"text/html");document.title=s.querySelector("title")?.text??"",J(s.body)}static replace(e){history.replaceState({},document.title,e)}};window.addEventListener("popstate",t=>{O.sendNewLocation(),t.state?.content!==void 0&&J(t.state.content,t.state.scrollY),M.replaceContentFromUrl(document.location.href)});var g={HistoryCache:M,morph:Q,navEvent:O};var Ce=new DOMParser,K=class{constructor(){this.components={}}open(e="__reactor__"){let n=location.protocol.replace("http","ws");this.socket=new H(`${n}//${location.host}/${e}`,[],{maxEnqueuedMessages:0}),this.socket.addEventListener("open",()=>{console.log("WS: OPEN"),this.sendQueryString(),this.components={},this.joinAllComponents()}),this.socket.addEventListener("message",a=>this._processMessage(a)),this.socket.addEventListener("close",()=>{console.log("WS: CLOSE"),this.components={},document.querySelectorAll("[reactor-component]").forEach(a=>{a.classList.add("reactor-disconnected"),a.dataset.isLive="false"})}),g.navEvent.addEventListener("newLocation",()=>{this.sendQueryString()}),g.navEvent.addEventListener("newContent",()=>{this.joinAllComponents()})}get isOpen(){return this.socket?.readyState==H.OPEN}joinAllComponents(){let e=new Set(Object.keys(this.components));for(let n of document.querySelectorAll("[reactor-component]"))if(e.delete(n.id))this.components[n.id].join();else{let a=new z(n.id);this.components[n.id]=a,a.join()}for(let n of e.keys())delete this.components[n],this.sendLeave(n)}_processMessage(e){let{command:n,payload:a}=JSON.parse(e.data);switch(n){case"render":var{id:s,diff:d}=a;console.log("<<< RENDER",s),this.components[s]?.applyDiff(d);break;case"append":case"prepend":case"insert_after":case"insert_before":case"replace_with":var{id:s,html:f}=a;console.log(`<<< ${n.toUpperCase()}`,s),f=Ce.parseFromString(f,"text/html").body.firstChild;var h=document.getElementById(s);if(h){switch(n){case"append":h.append(f);break;case"prepend":h.prepend(f);break;case"insert_after":h.after(f);break;case"insert_before":h.before(f);break;case"replace_with":g.morph(h,f);break}g.navEvent.sendNewContent()}break;case"remove":var{id:s}=a;console.log("<<< REMOVE",s),document.getElementById(s)?.remove(),g.navEvent.sendNewContent();break;case"focus_on":var{selector:m}=a;console.log("<<< FOCUS-ON",`"${m}"`,document.querySelector(m)),window.requestAnimationFrame(()=>document.querySelector(m)?.focus());break;case"scroll_into_view":var{id:s,behavior:b,block:R,inline:T}=a;window.requestAnimationFrame(()=>document.getElementById(s)?.scrollIntoView({behavior:b,block:R,inline:T}));break;case"url_change":var{url:E}=a;switch(console.log("<< URL",a.command,E),a.command){case"redirect":g.HistoryCache.load(E);break;case"replace":g.HistoryCache.replace(E);break;case"push":g.HistoryCache.push(E);break}break;case"set_query_string":var{qs:w}=a;w=w.length?`?${w}`:"",console.log("<< SET URL PARAMS",w),g.HistoryCache.replace(document.location.pathname+w);break;case"back":g.HistoryCache.back();break;default:console.error(`Unknown command "${n}"`,a)}}sendQueryString(){let e=document.location.search.slice(1);console.log("QS",e),this._send("query_string",{qs:e})}sendJoin(e,n,a,s){console.log(">>> JOIN",e,n),this._send("join",{name:e,state:a,children:s})}sendLeave(e){console.log(">>> LEAVE",e),this._send("leave",{id:e})}sendUserEvent(e,n,a,s){console.log(">>> USER_EVENT",e,n,s),this._send("user_event",{id:e,command:n,implicit_args:a,explicit_args:s})}_send(e,n){this.isOpen&&this.socket.send(JSON.stringify({command:e,payload:n}))}},A=new K,z=class{constructor(e){this.id=e,this.lastReceivedHtml=[]}getElemenet(){return document.getElementById(this.id)}applyDiff(e){window.requestAnimationFrame(()=>{let n=this.getElemenet();if(n){let a=this.getHtml(e);g.morph(n,a),g.navEvent.sendNewContent()}})}getHtml(e){let n=[],a=0;for(let s of e)typeof s=="string"?n.push(s):s<0?a-=s:(n.push(...this.lastReceivedHtml.slice(a,a+s)),a+=s);return this.lastReceivedHtml=n,n.join(" ")}join(){let e=this.getElemenet();if(e&&e.dataset.isLive==="false"){let n=e?.parentElement?.closest("[reactor-component]");if(!n||n.dataset.isLive==="true"){e.dataset.isLive="true";let a=Array.from(e.querySelectorAll("[reactor-component]")).reduce((s,d)=>(s[d.id]=[d.dataset.name,d.dataset.state],s),{});A.sendJoin(e.dataset.name,e.id,e.dataset.state,a)}}}dispatch(e,n,a){A.sendUserEvent(this.id,e,this.serialize(a),n)}serialize(e){let n={},a=this.getElemenet();for(let s of e.querySelectorAll("[name]")){if(s.closest("[reactor-component]")!==a)continue;let d=null;switch(s.type.toLowerCase()){case"checkbox":case"radio":d=s.checked?s.value||!0:null;break;case"select-multiple":d=s.selectedOptions.map(f=>f.value);break;default:d=s.value;break}if(d!==null){let f=s.getAttribute("name"),h=n[f]??[];h.push(d),n[f]=h}}return n}};A.open();var Y=void 0;window.reactor={send(t,e,n){let a=t.closest("[reactor-component]"),s=A.components[a.id];if(a!==null&&s!==void 0){let d=t.closest("form"),f=a.contains(d)?d:a;s.dispatch(e,n,f)}},debounce(t){return e=>(...n)=>{clearTimeout(Y),Y=setTimeout(()=>e(...n),t)}}};})();
/*!
 * Reconnecting WebSocket
 * by Pedro Ladaria <pedro.ladaria@gmail.com>
 * https://github.com/pladaria/reconnecting-websocket
 * License MIT
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
//# sourceMappingURL=reactor.min.js.map
