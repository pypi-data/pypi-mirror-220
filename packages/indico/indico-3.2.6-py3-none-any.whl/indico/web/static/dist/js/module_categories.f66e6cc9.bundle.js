"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[944],{24205:(e,t,a)=>{var n,r=a(63025),o=a(32735),l=a(12788),s=a(47169),i=a(28995);function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){(0,s.Z)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}(n=window).setupCategoryDisplaySubcatList=function(){const e=$(".category-list").data("subcat-info-url");void 0!==e&&$.ajax({url:e,dataType:"json",success(e){Object.entries(e.event_counts).forEach((e=>{let[t,a]=e;const n=a.value?i.$T.ngettext("{0} event","{0} events",a.value).format(a.pretty):i.$T.gettext("empty");$(`#category-event-count-${t}`).text(n)}))}})},n.setupCategoryDisplayEventList=function(e,t,a,n){const r=$(".event-list"),o=r.find(".future-events"),l=r.find(".past-events");function s(e,t){const a=$(e),r=a.find(".events");function o(e){a.find(".js-hide-message").toggle(e),a.find(".js-show-message").toggle(!e)}function l(e){a.find(".js-toggle-list").toggle(!e),a.find(".js-spinner").toggle(e)}o(!r.is(":empty")),l(!1),a.find(".js-toggle-list").on("click",(function(e,a){let s;e.preventDefault(),r.is(":empty")?(s=!0,l(!0),$.ajax({url:r.data("event-list-url"),data:d({before:r.data("event-list-before"),after:r.data("event-list-after")},n),error:handleAjaxError,success(e){r.html(e.html),r.show(),o(!0),l(!1)}})):r.is(":visible")?(s=!1,r.hide(),o(!1)):(s=!0,r.show(),o(!0)),!a&&t&&t(s)}))}a&&(n.flat=1),s(o,(function(e){a||$.ajax({url:r.data("show-future-events-url"),method:e?"PUT":"DELETE",error:handleAjaxError})})),s(l,(function(e){a||$.ajax({url:r.data("show-past-events-url"),method:e?"PUT":"DELETE",error:handleAjaxError})})),e&&!a&&o.find(".js-toggle-list").first().trigger("click",!0),t&&!a&&l.find(".js-toggle-list").first().trigger("click",!0)};var u=a(8892),m=a(19306);document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#category-calendar-link");if(!e)return;const t=e.dataset.categoryId;l.render(o.createElement(u.ICSCalendarLink,{endpoint:"categories.export_ical",params:{category_id:t},renderButton:e=>o.createElement(u.IButton,{icon:"calendar",title:m.vN.string("Export"),classes:e}),options:[{key:"category",text:m.vN.string("Category"),extraParams:{}}]}),e)})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#fav-button");if(!e)return;const t=e.dataset.categoryId,a=void 0!==e.dataset.favorited;l.render(o.createElement(u.Favorite,{type:"category",id:t,favorited:a,setFavText:m.vN.string("Add category to favorites (This will make events in this category visible on your Dashboard.)"),deleteFavText:m.vN.string("Delete category from favorites.")}),e)}));var g=a(50340),_=a(66049),y=a(53806),v=a.n(y),p=a(60216),E=a.n(p),f=a(27286),b=a(41187),h=a(77852),Z=a(69184),C=a(67986),D=a(4070),N=a(33344),j=a(88021),q=a(59090);const w={"./CategoryModeration.module.scss":{table:"categories-client-js-components-___CategoryModeration-module__table___Muk5s","no-border":"categories-client-js-components-___CategoryModeration-module__no-border___3wNOu",user:"categories-client-js-components-___CategoryModeration-module__user___D7Q+H",avatar:"categories-client-js-components-___CategoryModeration-module__avatar___gg2Un","table-footer":"categories-client-js-components-___CategoryModeration-module__table-footer___LCAAT",disabled:"categories-client-js-components-___CategoryModeration-module__disabled___kBJ15","text-separator":"categories-client-js-components-___CategoryModeration-module__text-separator___n+kI6"}},L=r.ZP.bind(null,{endpoint:"categories.api_event_move_requests",rules:[{args:["category_id"],converters:{category_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"api",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event-move-requests",isDynamic:!1}]}]},"/"),S=r.ZP.bind(null,{endpoint:"events.display",rules:[{args:["event_id"],converters:{},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1}]}]},"/");function x(){return o.createElement(f.Z.Row,null,o.createElement(f.Z.Cell,{collapsing:!0},o.createElement(b.Z,null)),o.createElement(f.Z.Cell,{colSpan:"5"},o.createElement(h.Z,{fluid:!0},o.createElement(h.Z.Header,{image:!0},o.createElement(h.Z.Line,null),o.createElement(h.Z.Line,null)))))}function R(e){let{requestor:t,event:a,category:n,requestorComment:r,requestedDt:l,selected:s,onSelect:i}=e;const{fullName:c,avatarURL:d,affiliation:u}=t;return o.createElement(o.Fragment,null,o.createElement(f.Z.Row,null,o.createElement(f.Z.Cell,{collapsing:!0},o.createElement(b.Z,{checked:s,onChange:i})),o.createElement(f.Z.Cell,{className:"categories-client-js-components-___CategoryModeration-module__user___D7Q+H"},o.createElement(Z.Z,{className:"categories-client-js-components-___CategoryModeration-module__avatar___gg2Un",src:d,size:"mini",avatar:!0}),o.createElement("span",null,c," ",u&&`(${u})`)),o.createElement(f.Z.Cell,null,o.createElement("a",{href:S({event_id:a.id})},a.title)),n?o.createElement(f.Z.Cell,null,n.chainTitles.join(" » ")):o.createElement(m.vN,{as:f.Z.Cell},"Unlisted event"),o.createElement(f.Z.Cell,null,function(e){let{startDt:t,endDt:a}=e;return t=v()(t),a=v()(a),t.isSame(a,"day")?`${t.format("L LT")} → ${a.format("LT")}`:`${t.format("L LT")} → ${a.format("L LT")}`}(a)),o.createElement(f.Z.Cell,null,o.createElement("span",{title:v()(l).format("L LT")},v()(l).fromNow()))),r?o.createElement(f.Z.Row,null,o.createElement(f.Z.Cell,{className:"categories-client-js-components-___CategoryModeration-module__no-border___3wNOu"}),o.createElement(f.Z.Cell,{colSpan:"5",className:"categories-client-js-components-___CategoryModeration-module__no-border___3wNOu"},r)):null)}function O(e){let{requests:t,onSubmit:a,loading:n}=e;const[r,l]=(0,o.useState)(new Set),[s,i]=(0,o.useState)(""),c=r.size>0,d=e=>{l(new Set),a(Array.from(r),e,s)};return 0!==t.length||n?o.createElement(f.Z,{className:"categories-client-js-components-___CategoryModeration-module__table___Muk5s"},o.createElement(f.Z.Header,null,o.createElement(f.Z.Row,null,o.createElement(f.Z.HeaderCell,null),o.createElement(m.vN,{as:f.Z.HeaderCell},"User"),o.createElement(m.vN,{as:f.Z.HeaderCell},"Event"),o.createElement(m.vN,{as:f.Z.HeaderCell},"Category"),o.createElement(m.vN,{as:f.Z.HeaderCell},"Event Date"),o.createElement(m.vN,{as:f.Z.HeaderCell},"Requested Date"))),o.createElement(f.Z.Body,null,n?o.createElement(x,null):t.map((e=>{let{id:t,requestor:a,requestorComment:n,event:s,category:i,requestedDt:c}=e;return o.createElement(R,{key:t,id:t,event:s,category:i,requestor:a,requestedDt:c,requestorComment:n,selected:r.has(t),onSelect:()=>(e=>l((t=>{const a=new Set([...t,e]);return t.has(e)&&a.delete(e),a})))(t)})}))),o.createElement(f.Z.Footer,{fullWidth:!0},o.createElement(f.Z.Row,null,o.createElement(f.Z.HeaderCell,null),o.createElement(f.Z.HeaderCell,{colSpan:"5"},o.createElement("div",{className:(0,_.Z)("table-footer "+(c?"":"disabled"),w,{autoResolveMultipleImports:!0,handleMissingStyleName:"throw"})},o.createElement(m.vN,{as:C.Z,onClick:()=>d(!0),color:"teal"},"Approve"),o.createElement(m.vN,{as:"span",className:"categories-client-js-components-___CategoryModeration-module__text-separator___n+kI6"},"or"),o.createElement(D.Z,{size:"small",placeholder:m.vN.string("Provide the rejection reason"),value:s,onChange:(e,t)=>{let{value:a}=t;return i(a)}}),o.createElement(m.vN,{as:"span",className:"categories-client-js-components-___CategoryModeration-module__text-separator___n+kI6"},"and"),o.createElement(m.vN,{as:C.Z,onClick:()=>d(!1),color:"red"},"Reject")))))):o.createElement(m.vN,{as:"p"},"There are no event move requests.")}function T(e){let{categoryId:t}=e;const{data:a,lastData:n,loading:r,reFetch:l}=(0,j.K3)({url:L({category_id:t})},{camelize:!0}),s=null==a?void 0:a.length;return(0,o.useEffect)((()=>{const e=document.querySelector("#side-menu-category-management-sidemenu .item.active .badge");e&&void 0!==s&&(s?e.textContent=s:e.style.display="none")}),[s]),n?o.createElement(O,{requests:a||[],onSubmit:async(e,a,n)=>{const r=L({category_id:t});try{await q.indicoAxios.post(r,{requests:e,accept:a,reason:n}),l()}catch(e){return(0,N.qf)(e)}},loading:!a||r}):null}R.propTypes={requestor:E().shape({fullName:E().string,avatarURL:E().string,affiliation:E().string}).isRequired,event:E().shape({id:E().number.isRequired,title:E().string.isRequired,startDt:E().string.isRequired,endDt:E().string.isRequired}).isRequired,category:E().shape({id:E().number.isRequired,chainTitles:E().arrayOf(E().string).isRequired}),requestedDt:E().string.isRequired,requestorComment:E().string.isRequired,selected:E().bool,onSelect:E().func.isRequired},R.defaultProps={selected:!1,category:null},O.propTypes={requests:E().array.isRequired,onSubmit:E().func.isRequired,loading:E().bool},O.defaultProps={loading:!1},T.propTypes={categoryId:E().number.isRequired};var I=a(3047),M=a(41612),k=a(34598),P=a(19855),Y=a(53130),A=a(25899),F=a(4925);const H=o.createContext(null),z=r.ZP.bind(null,{endpoint:"categories.statistics_json",rules:[{args:["category_id"],converters:{category_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"statistics.json",isDynamic:!1}]}]},"/");function U(e){let{categoryId:t}=e;const{data:a,loading:n}=(0,j.K3)({url:z({category_id:t})},{camelize:!0});return n?o.createElement(M.Z,{size:"massive",active:!0}):a?o.createElement(G,{data:a}):null}function G(e){let{data:t}=e;const a=(0,o.useContext)(H).replace("_","-"),n=v().utc(t.updated).local().format("LLL"),r=new Intl.NumberFormat(a),l=r.format(t.totalEvents),s=r.format(t.totalContributions),i=r.format(t.files),c=r.format(t.users),{eventGraph:d,contributionsGraph:u,series:g,axes:_,tooltip:y}=(0,o.useMemo)((()=>function(e){const t=t=>{const a=parseInt(Object.keys(t).reverse().find((t=>t<=e.maxYear+3)),10);return[[v()(e.minYear-1,"YYYY"),null],...Object.entries(t).filter((t=>{let[n]=t;return n<=a&&n>=e.minYear})).map((e=>{let[t,a]=e;return[v()(t,"YYYY"),a]})),[v()(a+1,"YYYY"),null]]};return{eventGraph:[{label:m.vN.string("Events"),data:t(e.events)}],contributionsGraph:[{label:m.vN.string("Contributions"),data:t(e.contributions)}],series:{type:"bar"},axes:[{primary:!0,type:"time",position:"bottom"},{type:"linear",position:"left"}],tooltip:{align:"left",anchor:"left"}}}(t)),[t]);return o.createElement(k.Z,null,o.createElement(P.Z.Group,{horizontal:!0},o.createElement(P.Z,null,o.createElement(Y.Z,{as:"h2"},o.createElement(Y.Z.Content,null,o.createElement(m.vN,null,"Number of events"),o.createElement(Y.Z.Subheader,null,o.createElement(m.vN,null,"The year is the one of the start date of the event.")))),o.createElement(P.Z,{basic:!0},0===d[0].data.length?o.createElement(A.Z,{info:!0},o.createElement(m.vN,null,"No data available")):o.createElement("div",{className:"categories-client-js-components-___CategoryStatistics-module__chart-container___FFFfl"},o.createElement(I.Chart,{className:"categories-client-js-components-___CategoryStatistics-module__chart___DIs5S",data:d,series:g,axes:_,tooltip:y})))),o.createElement(P.Z,null,o.createElement(Y.Z,{as:"h2"},o.createElement(Y.Z.Content,null,o.createElement(m.vN,null,"Number of contributions"),o.createElement(Y.Z.Subheader,null,o.createElement(m.vN,null,"The year is the one of the start date of the contribution.")))),o.createElement(P.Z,{basic:!0},0===u[0].data.length?o.createElement(A.Z,{info:!0},o.createElement(m.vN,null,"No data available")):o.createElement("div",{className:"categories-client-js-components-___CategoryStatistics-module__chart-container___FFFfl"},o.createElement(I.Chart,{className:"categories-client-js-components-___CategoryStatistics-module__chart___DIs5S",data:u,series:g,axes:_,tooltip:y}))))),o.createElement(P.Z.Group,{horizontal:!0},o.createElement(P.Z,{inverted:!0,color:"blue",textAlign:"center"},o.createElement(F.Z,{inverted:!0},o.createElement(F.Z.Value,null,l),o.createElement(F.Z.Label,null,o.createElement(m.vN,null,"Total number of events")))),o.createElement(P.Z,{inverted:!0,color:"blue",textAlign:"center"},o.createElement(F.Z,{inverted:!0},o.createElement(F.Z.Value,null,s),o.createElement(F.Z.Label,null,o.createElement(m.vN,null,"Total number of contributions")))),o.createElement(P.Z,{inverted:!0,color:"blue",textAlign:"center"},o.createElement(F.Z,{inverted:!0},o.createElement(F.Z.Value,null,i),o.createElement(F.Z.Label,null,o.createElement(m.vN,null,"Number of attachments")))),void 0!==t.users&&o.createElement(P.Z,{inverted:!0,color:"blue",textAlign:"center"},o.createElement(F.Z,{inverted:!0},o.createElement(F.Z.Value,null,c),o.createElement(F.Z.Label,null,o.createElement(m.vN,null,"Number of users"))))),o.createElement(m.vN,null,"Last updated on: ",o.createElement(m.dO,{name:"time",value:n})))}U.propTypes={categoryId:E().number.isRequired},G.propTypes={data:E().shape({contributions:E().object.isRequired,events:E().object.isRequired,files:E().number.isRequired,updated:E().string.isRequired,users:E().number,totalEvents:E().number.isRequired,totalContributions:E().number.isRequired,minYear:E().number.isRequired,maxYear:E().number.isRequired}).isRequired};const B=r.ZP.bind(null,{endpoint:"search.category_search",rules:[{args:["category_id"],converters:{category_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"search",isDynamic:!1}]}]},"/"),V=r.ZP.bind(null,{endpoint:"search.search",rules:[{args:[],converters:{},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"search",isDynamic:!1},{data:"/",isDynamic:!1}]}]},"/");!function(e){document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#search-box");if(e){const t=JSON.parse(e.dataset.category),a=void 0!==e.dataset.isAdmin;l.render(o.createElement(g.Z,{onSearch:(e,n,r)=>{const o={q:e};a&&r&&(o.admin_override_enabled=!0),n?window.location=V(o):(o.category_id=t.id,window.location=B(o))},category:t,isAdmin:a}),e)}})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#category-moderation");if(e){const t=parseInt(e.dataset.categoryId,10);l.render(o.createElement(T,{categoryId:t}),e)}})),e.setupCategoryStats=function(){document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#category-stats-root");if(!e)return;const t=parseInt(e.dataset.categoryId,10),a=e.dataset.lang;l.render(o.createElement(H.Provider,{value:a},o.createElement(U,{categoryId:t})),e)}))}}(window)}},e=>{e.O(0,[5514,3044,8592],(()=>{return t=24205,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=module_categories.f66e6cc9.bundle.js.map