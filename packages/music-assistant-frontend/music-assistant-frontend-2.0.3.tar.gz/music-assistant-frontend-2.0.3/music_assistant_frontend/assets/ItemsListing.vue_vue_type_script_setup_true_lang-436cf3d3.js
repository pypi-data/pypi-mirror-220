import{_ as he,L as ke,i as we,s as Ce}from"./ListviewItem-b7a4258b.js";/* empty css                             */import{p as Ve,m as Se,as as _e,g as $e,f as Ie,d as Me,r as g,w as z,o as j,j as r,k as A,at as Ae,au as Ne,q as m,y as N,Y as U,M as y,L as O,N as F,n as ne,a5 as Fe,a6 as Le,l as Pe,O as Be,I as Oe,b as ze,v as S,x as d,z as Q,F as X,A as Z,K,B as b,W as Ee,D as w}from"./index-e9211ef1.js";import{_ as Te}from"./PanelviewItem.vue_vue_type_style_index_0_lang-fefd2afe.js";import{C as x,L as De}from"./Container-349a0ac0.js";import{A as ee}from"./Alert-55091fd0.js";import{V as Re}from"./VToolbar-daf2b89f.js";import{V as qe}from"./VSpacer-bdf2f653.js";import{o as Ke,p as He,c as Ue,q as je,r as Ge,s as We,v as Ye,g as Je,i as Qe,w as Xe,x as Ze,l as P,V as D,k as xe}from"./VBtn-68784d55.js";import{V as et}from"./VBadge-9fa94f29.js";import{m as tt,a as at,f as ot,c as te,b as lt,V as nt}from"./VMenu-bc0cce60.js";import{a as ae}from"./VCard-138864fc.js";import{V as oe}from"./VDivider-336c24cd.js";import{V as it}from"./VSelect-04a129eb.js";import{V as st,a as rt}from"./VRow-e8f3e51e.js";const ut=Ve({multiLine:Boolean,timeout:{type:[Number,String],default:5e3},vertical:Boolean,...Ke({location:"bottom"}),...He(),...Ue(),...je(),...Se(),..._e(tt({transition:"v-snackbar-transition"}),["persistent","noClickAnimation","scrim","scrollStrategy"])},"VSnackbar"),ct=$e()({name:"VSnackbar",props:ut(),emits:{"update:modelValue":a=>!0},setup(a,p){let{slots:t}=p;const s=Ie(a,"modelValue"),{locationStyles:C}=Ge(a),{positionClasses:v}=We(a),{scopeId:n}=at(),{themeClasses:_}=Me(a),{colorClasses:L,colorStyles:V,variantClasses:$}=Ye(a),{roundedClasses:l}=Je(a),o=g();z(s,f),z(()=>a.timeout,f),j(()=>{s.value&&f()});let k=-1;function f(){window.clearTimeout(k);const c=Number(a.timeout);!s.value||c===-1||(k=window.setTimeout(()=>{s.value=!1},c))}function h(){window.clearTimeout(k)}return Qe(()=>{const[c]=te.filterProps(a);return r(te,A({ref:o,class:["v-snackbar",{"v-snackbar--active":s.value,"v-snackbar--multi-line":a.multiLine&&!a.vertical,"v-snackbar--vertical":a.vertical},v.value,a.class],style:a.style},c,{modelValue:s.value,"onUpdate:modelValue":I=>s.value=I,contentProps:A({class:["v-snackbar__wrapper",_.value,L.value,l.value,$.value],style:[C.value,V.value],onPointerenter:h,onPointerleave:f},c.contentProps),persistent:!0,noClickAnimation:!0,scrim:!1,scrollStrategy:"none",_disableGlobalStack:!0},n),{default:()=>[Xe(!1,"v-snackbar"),t.default&&r("div",{class:"v-snackbar__content",role:"status","aria-live":"polite"},[t.default()]),t.actions&&r(Ze,{defaults:{VBtn:{variant:"text",ripple:!1}}},{default:()=>[r("div",{class:"v-snackbar__actions"},[t.actions()])]})],activator:t.activator})}),ot({},o)}}),ie=(a,p)=>{const t=a.__vccOpts||a;for(const[s,C]of p)t[s]=C;return t},dt={},mt=a=>(Fe("data-v-259be2b2"),a=a(),Le(),a),vt={class:"container"},ft=mt(()=>O("div",{class:"spinner"},null,-1)),pt=[ft];function gt(a,p){return m(),N("div",vt,pt)}const bt=ie(dt,[["render",gt],["__scopeId","data-v-259be2b2"],["__file","/home/oumoussa/side-projects/infinite/src/components/Spinner.vue"]]),yt=a=>({loading(){a.value="loading"},loaded(){a.value="loaded"},complete(){a.value="complete"},error(){a.value="error"}}),ht=(a,p,t)=>()=>{const s=t.parentEl||document.documentElement;t.prevHeight=s.scrollHeight,p.loading(),a("infinite",p)},kt=(a,p)=>{const t=a.getBoundingClientRect();if(!p)return t.top>=0&&t.bottom<=window.innerHeight;const s=p.getBoundingClientRect();return t.top>=s.top&&t.bottom<=s.bottom},le=a=>{a.parentEl=document.querySelector(a.target)||null;let p=`0px 0px ${a.distance}px 0px`;a.top&&(p=`${a.distance}px 0px 0px 0px`);const t=new IntersectionObserver(s=>{s[0].isIntersecting&&(a.firstload&&a.emit(),a.firstload=!0)},{root:a.parentEl,rootMargin:p});return t.observe(a.infiniteLoading.value),t},wt={class:"state-error"},Ct={__name:"InfiniteLoading",props:{top:{type:Boolean,required:!1},target:{type:[String,Boolean],required:!1},distance:{type:Number,required:!1,default:0},identifier:{required:!1},firstload:{type:Boolean,required:!1,default:!0},slots:{type:Object,required:!1}},emits:["infinite"],setup(a,{emit:p}){const t=a;let s=null;const C=g(null),v=g("ready"),{top:n,firstload:_,target:L,distance:V}=t,{identifier:$}=Ae(t),l={infiniteLoading:C,target:L,top:n,firstload:_,distance:V,prevHeight:0,parentEl:null};l.emit=ht(p,yt(v),l);const o=()=>z(v,async f=>{const h=l.parentEl||document.documentElement;await ne(),f=="loaded"&&n&&(h.scrollTop=h.scrollHeight-l.prevHeight),f=="loaded"&&kt(C.value,l.parentEl)&&l.emit(),f=="complete"&&s.disconnect()}),k=()=>z($,()=>{v.value="ready",s.disconnect(),s=le(l)});return j(()=>{s=le(l),o(),$&&k()}),Ne(()=>{s.disconnect()}),(f,h)=>(m(),N("div",{ref_key:"infiniteLoading",ref:C},[v.value=="loading"?U(f.$slots,"spinner",{key:0},()=>[r(bt)],!0):y("v-if",!0),v.value=="complete"?U(f.$slots,"complete",{key:1},()=>{var c;return[O("span",null,F(((c=a.slots)==null?void 0:c.complete)||"No more results!"),1)]},!0):y("v-if",!0),v.value=="error"?U(f.$slots,"error",{key:2,retry:l.emit},()=>{var c;return[O("span",wt,[O("span",null,F(((c=a.slots)==null?void 0:c.error)||"Oops something went wrong!"),1),O("button",{class:"retry",onClick:h[0]||(h[0]=(...I)=>l.emit&&l.emit(...I))}," retry ")])]},!0):y("v-if",!0)],512))}},Vt=ie(Ct,[["__scopeId","data-v-9d82030b"],["__file","/home/oumoussa/side-projects/infinite/src/components/InfiniteLoading.vue"]]);const St={key:0},_t={key:2},$t={key:3},It={style:{height:"30px","margin-top":"20px"}},Ht=function(a,p,t,s,C,v=!0){var V,$;let n=[];if(C){const l=C.toLowerCase();for(const o of a)(o.name.toLowerCase().includes(l)||"artist"in o&&((V=o.artist)!=null&&V.name.toLowerCase().includes(l))||"album"in o&&(($=o.album)!=null&&$.name.toLowerCase().includes(l))||"artists"in o&&o.artists&&o.artists[0].name.toLowerCase().includes(l))&&n.push(o)}else n=a;s=="sort_name"&&n.sort((l,o)=>(l.sort_name||l.name).localeCompare(o.sort_name||o.name)),s=="sort_album"&&n.sort((l,o)=>{var k,f;return(f=l.album)==null?void 0:f.name.localeCompare((k=o.album)==null?void 0:k.name)}),s=="sort_artist"&&n.sort((l,o)=>l.artists[0].name.localeCompare(o.artists[0].name)),s=="track_number"&&(n.sort((l,o)=>(l.track_number||0)-(o.track_number||0)),n.sort((l,o)=>(l.disc_number||0)-(o.disc_number||0))),s=="position"&&n.sort((l,o)=>(l.position||0)-(o.position||0)),s=="position DESC"&&n.sort((l,o)=>(o.position||0)-(l.position||0)),s=="year"&&n.sort((l,o)=>(l.year||0)-(o.year||0)),s=="timestamp_added DESC"&&n.sort((l,o)=>(o.timestamp_added||0)-(l.timestamp_added||0)),s=="duration"&&n.sort((l,o)=>(l.duration||0)-(o.duration||0)),s=="provider"&&n.sort((l,o)=>l.provider.localeCompare(o.provider)),v&&(n=n.filter(l=>l.favorite));const _=n.length,L=n.slice(p,p+t);return{items:L,count:L.length,limit:t,offset:p,total:_}},Ut=Pe({__name:"ItemsListing",props:{itemtype:{},sortKeys:{default:()=>["sort_name","timestamp_added DESC"]},showTrackNumber:{type:Boolean,default:!0},showProvider:{type:Boolean,default:Object.keys(Be.providers).length>1},showAlbum:{type:Boolean,default:!0},showMenu:{type:Boolean,default:!0},showFavoritesOnlyFilter:{type:Boolean,default:!0},showDuration:{type:Boolean,default:!0},parentItem:{default:void 0},showAlbumArtistsOnlyFilter:{type:Boolean},updateAvailable:{type:Boolean},title:{},hideOnEmpty:{type:Boolean,default:!1},checksum:{default:void 0},loadData:{}},emits:["refreshClicked"],setup(a,{emit:p}){const t=a,s=100,C=Oe(),v=g("list"),n=g(""),_=g("sort_name"),L=g(!1),V=g(!1),$=g(!1),l=g(0),o=g([]),k=g(),f=g(!1),h=g(!1),c=g([]),I=g(!1),se=g(!1),E=g(!1),T=g(!0),re=function(){V.value?V.value=!1:(V.value=!0,ne(()=>{var e;(e=document.getElementById("searchInput"))==null||e.focus()}))},ue=function(e){return w({breakpoint:"bp1",condition:"lt",offset:b.sizeNavigationMenu})?2:w({breakpoint:"bp1",condition:"gt",offset:b.sizeNavigationMenu})&&w({breakpoint:"bp4",condition:"lt",offset:b.sizeNavigationMenu})?3:w({breakpoint:"bp4",condition:"gt",offset:b.sizeNavigationMenu})&&w({breakpoint:"bp6",condition:"lt",offset:b.sizeNavigationMenu})?4:w({breakpoint:"bp6",condition:"gt",offset:b.sizeNavigationMenu})&&w({breakpoint:"bp7",condition:"lt",offset:b.sizeNavigationMenu})?5:w({breakpoint:"bp7",condition:"gt",offset:b.sizeNavigationMenu})&&w({breakpoint:"bp8",condition:"lt",offset:b.sizeNavigationMenu})?6:w({breakpoint:"bp8",condition:"gt",offset:b.sizeNavigationMenu})&&w({breakpoint:"bp9",condition:"lt",offset:b.sizeNavigationMenu})?7:w({breakpoint:"bp9",condition:"gt",offset:b.sizeNavigationMenu})&&w({breakpoint:"bp10",condition:"lt",offset:b.sizeNavigationMenu})?8:w({breakpoint:"bp10",condition:"gt",offset:b.sizeNavigationMenu})?9:0},ce=function(){v.value==="panel"?v.value="list":v.value="panel",localStorage.setItem(`viewMode.${t.itemtype}`,v.value)},de=function(){h.value=!h.value;const e=h.value?"true":"false";localStorage.setItem(`favoriteFilter.${t.itemtype}`,e),M(!0)},me=function(){T.value=!T.value;const e=T.value?"true":"false";localStorage.setItem(`albumArtistsFilter.${t.itemtype}`,e),M(!0)},G=function(e){return c.value.includes(e)},W=function(e,u){if(u)c.value.includes(e)||c.value.push(e);else for(let i=0;i<c.value.length;i++)c.value[i]===e&&c.value.splice(i,1);b.blockGlobalPlayMenu=c.value.length>0},ve=function(){c.value=[],E.value=!1,b.blockGlobalPlayMenu=!1},H=function(){c.value.length>0?I.value=!0:E.value=!E.value},fe=function(e){M(!0)},q=function(e){c.value=[e],I.value=!0},pe=function(){M(!0),p("refreshClicked")},Y=function(e){var u;if(!we(e)){q(e);return}["artist","album","playlist"].includes(e.media_type)||!((u=b.selectedPlayer)!=null&&u.available)?C.push({name:e.media_type,params:{itemId:e.item_id,provider:e.provider}}):q(e)},ge=function(e,u){e!==void 0&&(_.value=e),localStorage.setItem(`sortBy.${t.itemtype}`,_.value),M(!0)},be=function(e){if(o.value.length==0){e.loaded();return}if(k.value!==void 0&&l.value>=k.value){e.loaded();return}l.value+=s,M().then(()=>{e.loaded()})},ye=function(){localStorage.setItem("globalsearch",n.value),C.push({name:"search",params:{initSearch:n.value}})};z(()=>n.value,e=>{e&&(V.value=!0),M(!0)}),z(()=>t.updateAvailable,e=>{e&&o.value.length==0&&M(!0)}),z(()=>t.checksum,e=>{e&&M(!0)});const M=async function(e=!1,u=s){e&&(l.value=0,se.value=!1),f.value=!0;const i=await t.loadData(l.value,u,_.value,n.value||"",h.value,T.value);l.value?o.value.push(...i.items):o.value=i.items,k.value=i.total,f.value=!1;let B=`search.${t.itemtype}`;t.parentItem&&(B+=t.parentItem.item_id),localStorage.setItem(B,n.value)};j(()=>{const e=localStorage.getItem(`viewMode.${t.itemtype}`);e&&e!=="null"?v.value=e:t.itemtype=="artists"||t.itemtype=="albums"?v.value="panel":v.value="list";const u=localStorage.getItem(`sortBy.${t.itemtype}`);if(u&&u!=="null"?_.value=u:_.value=t.sortKeys[0],t.showFavoritesOnlyFilter!==!1){const R=localStorage.getItem(`favoriteFilter.${t.itemtype}`);R&&R=="true"&&(h.value=!0)}if(t.showAlbumArtistsOnlyFilter!==!1){const R=localStorage.getItem(`albumArtistsFilter.${t.itemtype}`);R&&(T.value=R=="true")}let i=`search.${t.itemtype}`;t.parentItem&&(i+=t.parentItem.item_id);const B=localStorage.getItem(i);B&&B!=="null"&&(console.log("savedSearch",B),n.value=B),M(!0)});const J=function(e){I.value||(e.key==="a"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),c.value=o.value):!$.value&&e.key=="Backspace"?n.value=n.value.slice(0,-1):!$.value&&e.key.length==1&&(n.value+=e.key,V.value=!0))};return document.addEventListener("keydown",J),ze(()=>{document.removeEventListener("keydown",J)}),(e,u)=>e.hideOnEmpty&&o.value.length==0?y("",!0):(m(),S(x,{key:0},{default:d(()=>[r(he,{modelValue:I.value,"onUpdate:modelValue":u[0]||(u[0]=i=>I.value=i),items:c.value,"parent-item":e.parentItem,onClear:ve,onDelete:fe},null,8,["modelValue","items","parent-item"]),r(ae,null,{default:d(()=>[r(Re,{density:"compact",variant:"flat",color:"transparent"},{title:d(()=>[!e.$vuetify.display.mobile&&e.title?(m(),N("span",St,F(e.title),1)):y("",!0)]),default:d(()=>[r(qe),r(P,A(t,{icon:E.value?"mdi-checkbox-multiple-outline":"mdi-checkbox-multiple-blank-outline",variant:"plain",onClick:H,title:e.$t("tooltip.select_items")}),null,16,["icon","title"]),e.showFavoritesOnlyFilter!==!1?(m(),S(P,A({key:0},t,{icon:"",variant:"plain",onClick:de,title:e.$t("tooltip.filter_favorites")}),{default:d(()=>[r(D,{icon:h.value?"mdi-heart":"mdi-heart-outline"},null,8,["icon"])]),_:1},16,["title"])):y("",!0),e.showAlbumArtistsOnlyFilter?(m(),S(P,A({key:1},t,{icon:"",variant:"plain",onClick:me,title:e.$t("tooltip.album_artist_filter")}),{default:d(()=>[r(D,{icon:T.value?"mdi-account-music":"mdi-account-music-outline"},null,8,["icon"])]),_:1},16,["title"])):y("",!0),r(P,A(t,{icon:"",variant:"plain",onClick:u[1]||(u[1]=i=>pe()),title:e.updateAvailable?e.$t("tooltip.refresh_new_content"):e.$t("tooltip.refresh")}),{default:d(()=>[r(et,{"model-value":e.updateAvailable,color:"error",dot:""},{default:d(()=>[r(D,{icon:"mdi-refresh"})]),_:1},8,["model-value"])]),_:1},16,["title"]),e.sortKeys.length>1?(m(),S(lt,{key:2,modelValue:L.value,"onUpdate:modelValue":u[2]||(u[2]=i=>L.value=i),location:"bottom end","close-on-content-click":!0},{activator:d(({props:i})=>[r(P,A({icon:""},i,{variant:"plain",title:e.$t("tooltip.sort_options")}),{default:d(()=>[r(D,A(i,{icon:"mdi-sort"}),null,16)]),_:2},1040,["title"])]),default:d(()=>[r(ae,null,{default:d(()=>[r(nt,null,{default:d(()=>[(m(!0),N(X,null,Q(e.sortKeys,i=>(m(),N("div",{key:i},[r(De,{onClick:B=>ge(i)},{title:d(()=>[K(F(e.$t("sort."+i)),1)]),append:d(()=>[_.value==i?(m(),S(D,{key:0,icon:"mdi-check"})):y("",!0)]),_:2},1032,["onClick"]),r(oe)]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])):y("",!0),r(P,A(t,{icon:"",variant:"plain",onClick:u[3]||(u[3]=i=>re()),title:e.$t("tooltip.search")}),{default:d(()=>[r(D,{icon:"mdi-magnify"})]),_:1},16,["title"]),r(P,A(t,{icon:v.value=="panel"?"mdi-view-list":"mdi-grid",variant:"plain",onClick:u[4]||(u[4]=i=>ce()),title:e.$t("tooltip.toggle_view_mode")}),null,16,["icon","title"])]),_:1}),r(oe),V.value?(m(),S(it,{key:0,id:"searchInput",modelValue:n.value,"onUpdate:modelValue":u[5]||(u[5]=i=>n.value=i),clearable:"","prepend-inner-icon":"mdi-magnify",label:e.$t("search"),"hide-details":"",variant:"filled",style:{width:"auto","margin-left":"15px","margin-right":"15px","margin-top":"10px"},onFocus:u[6]||(u[6]=i=>$.value=!0),onBlur:u[7]||(u[7]=i=>$.value=!1)},null,8,["modelValue","label"])):y("",!0),r(x,null,{default:d(()=>[f.value?(m(),S(xe,{key:0,indeterminate:""})):y("",!0),v.value=="panel"?(m(),S(st,{key:1},{default:d(()=>[(m(!0),N(X,null,Q(o.value,i=>(m(),S(rt,{key:i.uri,class:Ee(`col-${ue(e.$vuetify.display.width)}`)},{default:d(()=>[r(Te,{item:i,"is-selected":G(i),"show-checkboxes":E.value,"show-track-number":e.showTrackNumber,onSelect:W,onMenu:q,onClick:Y},null,8,["item","is-selected","show-checkboxes","show-track-number"])]),_:2},1032,["class"]))),128))]),_:1})):y("",!0),v.value=="list"?(m(),N("div",_t,[r(Z(Ce),{items:o.value,"item-size":70,"key-field":"uri","page-mode":""},{default:d(({item:i})=>[(m(),S(ke,{key:i.uri,item:i,"show-track-number":e.showTrackNumber,"show-disc-number":e.showTrackNumber,"show-duration":e.showDuration,"show-favorite":e.showFavoritesOnlyFilter,"show-menu":e.showMenu,"show-provider":e.showProvider,"show-album":e.showAlbum,"show-checkboxes":E.value,"is-selected":G(i),"show-details":e.itemtype.includes("versions"),"parent-item":e.parentItem,onSelect:W,onMenu:q,onClick:Y},null,8,["item","show-track-number","show-disc-number","show-duration","show-favorite","show-menu","show-provider","show-album","show-checkboxes","is-selected","show-details","parent-item"]))]),_:1},8,["items"])])):y("",!0),r(Z(Vt),{onInfinite:be}),!f.value&&o.value.length==0?(m(),N("div",$t,[!f.value&&o.value.length==0&&(n.value||h.value)?(m(),S(ee,{key:0,title:e.$t("no_content_filter")},{default:d(()=>[n.value?(m(),S(P,{key:0,style:{"margin-top":"15px"},onClick:ye},{default:d(()=>[K(F(e.$t("try_global_search")),1)]),_:1})):y("",!0)]),_:1},8,["title"])):!f.value&&o.value.length==0?(m(),S(ee,{key:1},{default:d(()=>[K(F(e.$t("no_content")),1)]),_:1})):y("",!0)])):y("",!0),r(ct,{"model-value":c.value.length>1,timeout:-1,style:{"margin-bottom":"120px"}},{actions:d(()=>[r(P,{color:"primary",variant:"text",onClick:u[8]||(u[8]=i=>I.value=!0)},{default:d(()=>[K(F(e.$t("actions")),1)]),_:1})]),default:d(()=>[O("span",null,F(e.$t("items_selected",[c.value.length])),1)]),_:1},8,["model-value"]),O("div",It,[!c.value.length&&k.value?(m(),N("span",{key:0,style:{cursor:"pointer"},onClick:H},F(e.$t("items_total",[k.value])),1)):c.value.length?(m(),N("span",{key:1,style:{cursor:"pointer"},onClick:H},F(e.$t("items_selected",[c.value.length])),1)):y("",!0)])]),_:1})]),_:1})]),_:1}))}});export{Ut as _,Ht as f};
