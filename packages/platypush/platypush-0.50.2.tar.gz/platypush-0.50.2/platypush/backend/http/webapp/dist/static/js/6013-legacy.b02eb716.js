(self["webpackChunkplatypush"]=self["webpackChunkplatypush"]||[]).push([[6013],{2481:function(t,e,s){var a=s(2109),n=s(8415);a({target:"String",proto:!0},{repeat:n})},6013:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return G}});s(2481);var a=s(6252),n=s(3577),r=function(t){return(0,a.dD)("data-v-75982eb8"),t=t(),(0,a.Cn)(),t},i={key:1,class:"music"},u={class:"track"},c={key:0,class:"unknown"},o={key:1,class:"no-track"},l=["textContent"],p=["textContent"],h={key:0,class:"time"},m={class:"row"},g={class:"progress-bar"},d=r((function(){return(0,a._)("div",{class:"total"},null,-1)})),f={class:"row"},k=["textContent"],v=["textContent"],w={key:1,class:"controls"},y=r((function(){return(0,a._)("i",{class:"fa fa-step-backward"},null,-1)})),_=[y],b={key:0,class:"fa fa-pause"},x={key:1,class:"fa fa-play"},C=r((function(){return(0,a._)("i",{class:"fa fa-stop"},null,-1)})),T=[C],R=r((function(){return(0,a._)("i",{class:"fa fa-step-forward"},null,-1)})),P=[R],S={key:2,class:"playback-status"},D={class:"status-property col-4"},q=r((function(){return(0,a._)("i",{class:"fa fa-volume-up"},null,-1)})),M=(0,a.Uk)("Â  "),Z=["textContent"],I={class:"status-property col-2"},N={class:"status-property col-2"},E={class:"status-property col-2"},F={class:"status-property col-2"};function O(t,e,s,r,y,C){var R=(0,a.up)("Loading");return y.loading?((0,a.wg)(),(0,a.j4)(R,{key:0})):((0,a.wg)(),(0,a.iD)("div",i,[(0,a._)("div",u,[y.status?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",c,"[Unknown state]")),y.status&&"stop"===y.status.state?((0,a.wg)(),(0,a.iD)("div",o,"No media is being played")):(0,a.kq)("",!0),y.status&&"stop"!==y.status.state&&y.track&&y.track.artist?((0,a.wg)(),(0,a.iD)("div",{key:2,class:"artist",textContent:(0,n.zw)(y.track.artist)},null,8,l)):(0,a.kq)("",!0),y.status&&"stop"!==y.status.state&&y.track&&y.track.title?((0,a.wg)(),(0,a.iD)("div",{key:3,class:"title",textContent:(0,n.zw)(y.track.title)},null,8,p)):(0,a.kq)("",!0)]),y.status&&"play"===y.status.state?((0,a.wg)(),(0,a.iD)("div",h,[(0,a._)("div",m,[(0,a._)("div",g,[(0,a._)("div",{class:"elapsed",style:(0,n.j5)({width:y.track.time?y.status.elapsed/y.track.time*100+"%":"100%"})},null,4),d])]),(0,a._)("div",f,[(0,a._)("div",{class:"col-6 time-elapsed",textContent:(0,n.zw)(C.convertTime(y.status.elapsed))},null,8,k),y.track.time?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"col-6 time-total",textContent:(0,n.zw)(C.convertTime(y.track.time))},null,8,v)):(0,a.kq)("",!0)])])):(0,a.kq)("",!0),C._withControls&&y.status?((0,a.wg)(),(0,a.iD)("div",w,[(0,a._)("button",{onClick:e[0]||(e[0]=function(){return C.prev&&C.prev.apply(C,arguments)})},_),(0,a._)("button",{class:"play-pause",onClick:e[1]||(e[1]=function(){return C.playPause&&C.playPause.apply(C,arguments)})},["play"===y.status.state?((0,a.wg)(),(0,a.iD)("i",b)):((0,a.wg)(),(0,a.iD)("i",x))]),"stop"!==y.status.state?((0,a.wg)(),(0,a.iD)("button",{key:0,onClick:e[2]||(e[2]=function(){return C.stop&&C.stop.apply(C,arguments)})},T)):(0,a.kq)("",!0),(0,a._)("button",{onClick:e[3]||(e[3]=function(){return C.next&&C.next.apply(C,arguments)})},P)])):(0,a.kq)("",!0),y.status?((0,a.wg)(),(0,a.iD)("div",S,[(0,a._)("div",D,[q,M,(0,a._)("span",{textContent:(0,n.zw)(y.status.volume+"%")},null,8,Z)]),(0,a._)("div",I,[(0,a._)("i",{class:(0,n.C_)(["fas fa-random",{active:y.status.random}])},null,2)]),(0,a._)("div",N,[(0,a._)("i",{class:(0,n.C_)(["fas fa-redo",{active:y.status.repeat}])},null,2)]),(0,a._)("div",E,[(0,a._)("i",{class:(0,n.C_)(["fa fa-bullseye",{active:y.status.single}])},null,2)]),(0,a._)("div",F,[(0,a._)("i",{class:(0,n.C_)(["fa fa-utensils",{active:y.status.consume}])},null,2)])])):(0,a.kq)("",!0)]))}var j=s(6084),z=s(8534),V=(s(5666),s(9653),s(9600),s(9720),s(6977),s(6813)),B=s(1232),L={name:"Music",components:{Loading:B.Z},mixins:[V.Z],props:{refreshSeconds:{type:Number,default:60},withControls:{type:Boolean,default:!0}},data:function(){return{track:void 0,status:void 0,timer:void 0,loading:!1,musicPlugin:"music.mpd",syncTime:{timestamp:null,elapsed:null}}},computed:{_withControls:function(){return this.parseBoolean(this.withControls)}},methods:{refresh:function(){var t=this;return(0,z.Z)(regeneratorRuntime.mark((function e(){var s,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.prev=1,e.next=4,t.request("".concat(t.musicPlugin,".status"));case 4:return s=e.sent,e.next=7,t.request("".concat(t.musicPlugin,".current_track"));case 7:a=e.sent,t._parseStatus(s),t._parseTrack(a),"play"!==s.state||t.timer?"play"!==s.state&&t.timer&&t.stopTimer():t.startTimer();case 11:return e.prev=11,t.loading=!1,e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[1,,11,14]])})))()},convertTime:function(t){t=parseFloat(t);var e={};e.h=parseInt(t/3600),e.m=parseInt(t/60-60*e.h),e.s=parseInt(t-(3600*e.h+60*e.m));for(var s=0,a=["m","s"];s<a.length;s++){var n=a[s];e[n]=""+e[n]}for(var r=0,i=["m","s"];r<i.length;r++){var u=i[r];parseInt(e[u])<10&&(e[u]="0"+e[u])}var c=[];return parseInt(e.h)&&c.push(e.h),c.push(e.m,e.s),c.join(":")},_parseStatus:function(t){var e=this;return(0,z.Z)(regeneratorRuntime.mark((function s(){var a,n,r,i,u,c;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(t&&0!==t.length){s.next=4;break}return s.next=3,e.request("".concat(e.musicPlugin,".status"));case 3:t=s.sent;case 4:for(null!==(a=t)&&void 0!==a&&a.pluginName&&(e.musicPlugin=t.pluginName),e.status||(e.status={}),n=0,r=Object.entries(t);n<r.length;n++)i=(0,j.Z)(r[n],2),u=i[0],c=i[1],["consume","random","repeat","single","bitrate"].indexOf(u)>=0?e.status[u]=!!parseInt(c):["nextsong","nextsongid","playlist","playlistlength","volume","xfade","song","songid"].indexOf(u)>=0?e.status[u]=parseInt(c):["elapsed"].indexOf(u)>=0?e.status[u]=parseFloat(c):e.status[u]=c;case 7:case"end":return s.stop()}}),s)})))()},_parseTrack:function(t){var e=this;return(0,z.Z)(regeneratorRuntime.mark((function s(){var a,n,r,i,u;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(t&&0!==t.length){s.next=4;break}return s.next=3,e.request("".concat(e.musicPlugin,".current_track"));case 3:t=s.sent;case 4:for(e.track||(e.track={}),a=0,n=Object.entries(t);a<n.length;a++)r=(0,j.Z)(n[a],2),i=r[0],u=r[1],["id","pos","time","track","disc"].indexOf(i)>=0?e.track[i]=parseInt(u):e.track[i]=u;case 6:case"end":return s.stop()}}),s)})))()},showNewTrackNotification:function(){this.notify({html:"<b>"+(this.track.artist||"[No Artist]")+"</b><br>"+(this.track.title||"[No Title]"),image:{icon:"play"}})},onNewPlayingTrack:function(t){var e=this;return(0,z.Z)(regeneratorRuntime.mark((function s(){var a,n;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(a=void 0,e.track&&(a={file:e.track.file,artist:e.track.artist,title:e.track.title}),e.status.state="play",e.status.elapsed=0,e.track={},e._parseTrack(t.track),!t.status){s.next=10;break}s.t0=t.status,s.next=13;break;case 10:return s.next=12,e.request("".concat(e.musicPlugin,".status"));case 12:s.t0=s.sent;case 13:n=s.t0,e._parseStatus(n),e.startTimer(),a&&e.track.file===a.file&&e.track.artist===a.artist&&e.track.title===a.title||e.showNewTrackNotification();case 17:case"end":return s.stop()}}),s)})))()},onMusicStop:function(t){this.status.state="stop",this.status.elapsed=0,this._parseStatus(t.status),this._parseTrack(t.track),this.stopTimer()},onMusicPlay:function(t){this.status.state="play",this._parseStatus(t.status),this._parseTrack(t.track),this.startTimer()},onMusicPause:function(t){this.status.state="pause",this._parseStatus(t.status),this._parseTrack(t.track),this.syncTime.timestamp=new Date,this.syncTime.elapsed=this.status.elapsed},onSeekChange:function(t){null!=t.position&&(this.status.elapsed=parseFloat(t.position)),t.status&&this._parseStatus(t.status),t.track&&this._parseTrack(t.track),this.syncTime.timestamp=new Date,this.syncTime.elapsed=this.status.elapsed},onVolumeChange:function(t){null!=t.volume&&(this.status.volume=parseFloat(t.volume)),t.status&&this._parseStatus(t.status),t.track&&this._parseTrack(t.track)},onRepeatChange:function(t){this.status.repeat=t.state},onRandomChange:function(t){this.status.random=t.state},onConsumeChange:function(t){this.status.consume=t.state},onSingleChange:function(t){this.status.single=t.state},startTimer:function(){null!=this.timer&&this.stopTimer(),this.syncTime.timestamp=new Date,this.syncTime.elapsed=this.status.elapsed,this.timer=setInterval(this.timerFunc,1e3)},stopTimer:function(){null==this.timer&&(clearInterval(this.timer),this.timer=null)},timerFunc:function(){"play"===this.status.state&&null!=this.status.elapsed&&(this.status.elapsed=this.syncTime.elapsed+(new Date).getTime()/1e3-this.syncTime.timestamp.getTime()/1e3)},_run:function(t,e){var s=this;return(0,z.Z)(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e=e||{},a.next=3,s.request("music.mpd.".concat(t),e);case 3:return a.next=5,s.refresh();case 5:case"end":return a.stop()}}),a)})))()},playPause:function(){var t=this;return(0,z.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t._run("pause");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()},stop:function(){var t=this;return(0,z.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t._run("stop");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()},prev:function(){var t=this;return(0,z.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t._run("previous");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()},next:function(){var t=this;return(0,z.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t._run("next");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()}},mounted:function(){this.refresh(),this.refreshSeconds&&setInterval(this.refresh,parseInt((1e3*this.refreshSeconds).toFixed(0))),this.subscribe(this.onNewPlayingTrack,"widget-music-on-new-track","platypush.message.event.music.NewPlayingTrackEvent"),this.subscribe(this.onMusicStop,"widget-music-on-music-stop","platypush.message.event.music.MusicStopEvent"),this.subscribe(this.onMusicPlay,"widget-music-on-music-play","platypush.message.event.music.MusicPlayEvent"),this.subscribe(this.onMusicPause,"widget-music-on-music-pause","platypush.message.event.music.MusicPauseEvent"),this.subscribe(this.onSeekChange,"widget-music-on-music-seek","platypush.message.event.music.SeekChangeEvent"),this.subscribe(this.onVolumeChange,"widget-music-on-volume-change","platypush.message.event.music.VolumeChangeEvent"),this.subscribe(this.onRepeatChange,"widget-music-on-repeat-change","platypush.message.event.music.PlaybackRepeatModeChangeEvent"),this.subscribe(this.onRandomChange,"widget-music-on-random-change","platypush.message.event.music.PlaybackRandomModeChangeEvent"),this.subscribe(this.onConsumeChange,"widget-music-on-consume-change","platypush.message.event.music.PlaybackConsumeModeChangeEvent"),this.subscribe(this.onSingleChange,"widget-music-on-single-change","platypush.message.event.music.PlaybackSingleModeChangeEvent")}},U=s(3744);const A=(0,U.Z)(L,[["render",O],["__scopeId","data-v-75982eb8"]]);var G=A}}]);
//# sourceMappingURL=6013-legacy.b02eb716.js.map