"use strict";(self.webpackChunkvdk_jupyterlab_extension=self.webpackChunkvdk_jupyterlab_extension||[]).push([[161],{161:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Y,workingDirectory:()=>K});var n,o=a(38),l=a(33),s=a(271),r=a.n(s);!function(e){e.NAME="jobName",e.TEAM="jobTeam",e.PATH="jobPath",e.CLOUD="cloud",e.LOCAL="local",e.ARGUMENTS="jobArguments",e.DEPLOYMENT_REASON="deploymentReason",e.DEPLOY_ENABLE="enableDeploy"}(n||(n={}));var c=new Map([]);function i(){for(const e of Object.values(n))c.set(e,"")}function u(){return{jobName:c.get(n.NAME),jobTeam:c.get(n.TEAM),jobPath:c.get(n.PATH),cloud:c.get(n.CLOUD),local:c.get(n.LOCAL),jobArguments:c.get(n.ARGUMENTS),deploymentReason:c.get(n.DEPLOYMENT_REASON),enableDeploy:c.get(n.DEPLOY_ENABLE)}}async function d(e){return!!c.get(e)||(await(0,l.showErrorMessage)("Encountered an error while trying to execute operation. Error:","The "+e+" should be defined!",[l.Dialog.okButton()]),!1)}i();const m=e=>{const t=e.split(/(?=[/\\])/);return t[t.length-1]};class p extends s.Component{constructor(e){super(e),this.onInputChange=e=>{let t=e.currentTarget.value;t||(t=this.props.value),c.set(this.props.option,t)}}render(){return r().createElement(r().Fragment,null,r().createElement("div",{className:"jp-vdk-input-wrapper"},r().createElement("label",{className:"jp-vdk-label",htmlFor:this.props.option},this.props.label),r().createElement("input",{type:"text",id:this.props.option,className:"jp-vdk-input",placeholder:m(this.props.value),onChange:this.onInputChange})))}}var h=a(142),g=a(820);async function b(e="",t={}){const a=g.ServerConnection.makeSettings(),n=h.URLExt.join(a.baseUrl,"vdk-jupyterlab-extension",e);let o;try{o=await g.ServerConnection.makeRequest(n,t,a)}catch(e){throw e}let l=await o.text();if(l.length>0)try{l=JSON.parse(l)}catch(e){console.log("Not a JSON response body.",o)}if(!o.ok)throw new Error(o.statusText);return l}const E=async e=>{await(0,l.showErrorMessage)("Encountered an error while trying to connect the server. Error:",e,[l.Dialog.okButton()])};async function v(){if(!await d(n.PATH))return{message:"",status:!1};try{const e=await b("run",{body:JSON.stringify(u()),method:"POST"});return{message:e.message,status:"0"==e.message}}catch(e){return E(e),{message:"",status:!1}}}async function y(e){if(await d(n.NAME)&&await d(n.TEAM))try{const t=await b(e,{body:JSON.stringify(u()),method:"POST"});t.error?await(0,l.showErrorMessage)("Encountered an error while trying the "+e+" operation. Error:",t.message,[l.Dialog.okButton()]):alert(t.message)}catch(e){E(e)}}class k{constructor(e){this.exception_message="",this.what_happened="",this.why_it_happened="",this.consequences="",this.countermeasures="",this.__parse_message(e)}__parse_message(e){const t=["exception_message","what_happened","why_it_happened","consequences","countermeasures"],a=["ERROR : ","WHAT HAPPENED :","WHY IT HAPPENED :","CONSEQUENCES :","COUNTERMEASURES :"],n=e.split("\n");let o=0;for(let l=0;l<n.length;l++){const s=n[l].indexOf(a[o]);if(-1!==s){if(this[t[o]]=a[o]+n[l].substring(s+a[o].length),o++,o===t.length)break}else this.exception_message=e}}}const w="Convert Job To Notebook",f="Run Job",j="Create Deployment";class N extends s.Component{constructor(e){super(e),this._onArgsChange=e=>{let t=e.currentTarget.value;t&&this._isJSON(t)&&c.set(n.ARGUMENTS,t)},this._isJSON=e=>{try{return JSON.parse(e),!0}catch(e){return!1}}}render(){return r().createElement(r().Fragment,null,r().createElement(p,{option:n.PATH,value:this.props.jobPath,label:"Path to job directory:"}),r().createElement("div",{className:"jp-vdk-input-wrapper"},r().createElement("label",{className:"jp-vdk-label",htmlFor:"arguments"},"Arguments:"),r().createElement("input",{type:"text",id:"arguments",className:"jp-vdk-input",placeholder:'{"key": "value"}',onChange:this._onArgsChange})),r().createElement("ul",{id:"argumentsUl",className:"hidden"}))}}async function C(e){if((await(0,l.showDialog)({title:f,body:r().createElement(N,{jobPath:c.get(n.PATH)}),buttons:[l.Dialog.okButton(),l.Dialog.cancelButton()]})).button.accept){let{message:t,status:a}=await v();if(a)(0,l.showDialog)({title:f,body:r().createElement("div",{className:"vdk-run-dialog-message-container"},r().createElement("p",{className:"vdk-run-dialog-message"},"The job was executed successfully!")),buttons:[l.Dialog.okButton()]});else{t="ERROR : "+t;const a=new k(t);e&&await P(a,e)||(0,l.showDialog)({title:f,body:r().createElement("div",{className:"vdk-run-error-message "},r().createElement("p",null,a.exception_message),r().createElement("p",null,a.what_happened),r().createElement("p",null,a.why_it_happened),r().createElement("p",null,a.consequences),r().createElement("p",null,a.countermeasures)),buttons:[l.Dialog.okButton()]})}}}const A=e=>{const t=e.getElementsByClassName("jp-Cell-inputWrapper");for(let e=0;e<t.length;e++){const a=t[e].getElementsByClassName("jp-Cell-inputArea");if(a.length>0){const e=a[0].getElementsByClassName("jp-InputArea-prompt");if(e.length>0)return e[0]}}},D=e=>{const t=A(e);null==t||t.classList.add("jp-vdk-failing-cell-prompt"),e.scrollIntoView(),e.classList.add("jp-vdk-failing-cell"),Array.from(document.getElementsByClassName("jp-vdk-failing-cell-num")).forEach((e=>{e.classList.remove("jp-vdk-failing-cell-num"),e.classList.add("jp-vdk-cell-num")}))},T=e=>{e.classList.remove("jp-vdk-failing-cell");const t=A(e);null==t||t.classList.remove("jp-vdk-failing-cell-prompt")},P=async(e,t)=>{const a=(e=>{const t=e.match(/cell_id:([0-9a-fA-F-]+)/);return t?t[1]:""})(e.what_happened);if(a){const{path:o,cellIndex:s}=await async function(e){const t={cellId:e,jobPath:c.get(n.PATH)};if(!await d(n.PATH))return{path:"",cellIndex:""};try{const e=await b("notebook",{body:JSON.stringify(t),method:"POST"});return{path:e.path,cellIndex:e.cellIndex}}catch(e){return{path:"",cellIndex:""}}}(a);if(o){const a=async()=>{const e=t.openOrReveal(o);if(e){await e.revealed;const t=Array.from(e.node.children);t&&t.forEach((async e=>{e.classList.contains("jp-Notebook")&&(async(e,t,a)=>{const n=e.children;if(t>n.length)(0,l.showDialog)({title:"Run Failed",body:r().createElement("div",null,r().createElement("p",null,"Sorry, something went wrong while trying to find the failing cell!"),r().createElement("p",null,"Please, check the ",a," once more and try to run the job while the notebook is active!")),buttons:[l.Dialog.cancelButton()]});else for(let e=0;e<n.length;e++)e===t?D(n[e]):T(n[e])})(e,Number(s),o)}))}};return(await(0,l.showDialog)({title:f,body:r().createElement("div",{className:"vdk-run-error-message "},r().createElement("p",null,e.exception_message),r().createElement("p",null,e.what_happened),r().createElement("p",null,e.why_it_happened),r().createElement("p",null,e.consequences),r().createElement("p",null,e.countermeasures)),buttons:[l.Dialog.okButton({label:"See failing cell"}),l.Dialog.cancelButton()]})).button.accept&&a(),!0}}return!1};class L extends s.Component{constructor(e){super(e)}render(){return r().createElement(r().Fragment,null,r().createElement(p,{option:n.NAME,value:this.props.jobName,label:"Job Name:"}),r().createElement(p,{option:n.TEAM,value:this.props.jobTeam,label:"Job Team:"}),r().createElement(p,{option:n.PATH,value:this.props.jobPath,label:"Path to job directory:"}),r().createElement(p,{option:n.DEPLOYMENT_REASON,value:"reason",label:"Deployment reason:"}),r().createElement("div",null,r().createElement("input",{type:"checkbox",name:"enable",id:"enable",className:"jp-vdk-checkbox",onClick:this.onEnableClick()}),r().createElement("label",{className:"checkboxLabel",htmlFor:"enable"},"Enable")))}onEnableClick(){return e=>{const t=document.getElementById("enable");(null==t?void 0:t.classList.contains("checked"))?(t.classList.remove("checked"),c.set(n.DEPLOY_ENABLE,"")):(null==t||t.classList.add("checked"),c.set(n.DEPLOY_ENABLE,"1"))}}}async function _(){const e=await(0,l.showDialog)({title:j,body:r().createElement(L,{jobName:c.get(n.NAME),jobPath:c.get(n.PATH),jobTeam:c.get(n.TEAM)}),buttons:[l.Dialog.okButton(),l.Dialog.cancelButton()]});if(!e.value&&e.button.accept)try{if((await(0,l.showDialog)({title:j,body:"The job will be executed once before deployment.",buttons:[l.Dialog.cancelButton({label:"Cancel"}),l.Dialog.okButton({label:"Continue"})]})).button.accept){const{message:e,status:t}=await v();t?await d(n.DEPLOYMENT_REASON)&&await y("deploy"):(0,l.showErrorMessage)("EncÐ¾untered an error while running the job!",e,[l.Dialog.okButton()])}}catch(e){await(0,l.showErrorMessage)("Encountered an error when deploying the job. Error:",e,[l.Dialog.okButton()])}}class x extends s.Component{constructor(e){super(e)}render(){return r().createElement(r().Fragment,null,r().createElement("div",{className:"jp-vdk-checkbox-wrappers"},r().createElement("div",null,r().createElement("input",{type:"checkbox",name:"Local",id:"Local",className:"jp-vdk-checkbox",onClick:this._onLocalClick()}),r().createElement("label",{className:"checkboxLabel",htmlFor:"Local"},"Local")),r().createElement("div",null,r().createElement("input",{type:"checkbox",name:"Cloud",id:"Cloud",className:"jp-vdk-checkbox",onClick:this._onCloudClick()}),r().createElement("label",{className:"checkboxLabel",htmlFor:"Cloud"},"Cloud"))),r().createElement(p,{option:n.NAME,value:this.props.jobName,label:"Job Name:"}),r().createElement(p,{option:n.TEAM,value:this.props.jobTeam,label:"Job Team:"}),r().createElement(p,{option:n.PATH,value:this.props.jobPath,label:"Path to job directory:"}))}_onLocalClick(){return e=>{this.setJobFlags("Local")}}_onCloudClick(){return e=>{this.setJobFlags("Cloud")}}setJobFlags(e){let t=document.getElementById(e);(null==t?void 0:t.classList.contains("checked"))?(t.classList.remove("checked"),"Cloud"===e?c.set(n.CLOUD,""):c.set(n.LOCAL,"")):(null==t||t.classList.add("checked"),"Cloud"===e?c.set(n.CLOUD,"1"):c.set(n.LOCAL,"1"))}}async function O(){(await(0,l.showDialog)({title:"Create Job",body:r().createElement(x,{jobPath:c.get(n.PATH),jobName:c.get(n.NAME),jobTeam:c.get(n.TEAM)}),buttons:[l.Dialog.okButton(),l.Dialog.cancelButton()]})).button.accept&&await y("create")}class B extends s.Component{constructor(e){super(e)}render(){return r().createElement(r().Fragment,null,r().createElement(p,{option:n.NAME,value:"default-name",label:"Job Name:"}),r().createElement(p,{option:n.TEAM,value:"default-team",label:"Job Team:"}),r().createElement(p,{option:n.PATH,value:this.props.jobPath,label:"Path to job directory:"}))}}async function S(){(await(0,l.showDialog)({title:"Download Job",body:r().createElement(B,{jobPath:c.get(n.PATH)}),buttons:[l.Dialog.okButton(),l.Dialog.cancelButton()]})).button.accept&&await y("download")}class M extends s.Component{constructor(e){super(e)}render(){return r().createElement(r().Fragment,null,r().createElement(p,{option:n.PATH,value:this.props.jobPath,label:"Path to job directory:"}))}}async function J(){if((await(0,l.showDialog)({title:w,body:r().createElement(M,{jobPath:c.get(n.PATH)}),buttons:[l.Dialog.okButton(),l.Dialog.cancelButton()]})).button.accept&&(await(0,l.showDialog)({title:w,body:r().createElement("p",null,"Are you sure you want to convert the Data Job with path:"," ",r().createElement("i",null,c.get(n.PATH))," to notebook?"),buttons:[l.Dialog.okButton(),l.Dialog.cancelButton()]})).button.accept){let{message:e,status:t}=await async function(){if(!await d(n.PATH))return{message:"",status:!1};try{const e=await b("convertJobToNotebook",{body:JSON.stringify(u()),method:"POST"});return{message:e.message,status:"0"==e.message}}catch(e){return E(e),{message:"",status:!1}}}();if(t)await(0,l.showDialog)({title:w,body:r().createElement("div",{className:"vdk-convert-to-notebook-dialog-message-container"},r().createElement("p",{className:"vdk-convert-to-notebook-dialog-message"},"The Data Job with path ",r().createElement("i",null,c.get(n.PATH))," was converted to notebook successfully!")),buttons:[l.Dialog.okButton()]});else{e="ERROR : "+e;const t=new k(e);await(0,l.showDialog)({title:w,body:r().createElement("div",{className:"vdk-convert-to-notebook-error-message "},r().createElement("p",null,t.exception_message),r().createElement("p",null,t.what_happened),r().createElement("p",null,t.why_it_happened),r().createElement("p",null,t.consequences),r().createElement("p",null,t.countermeasures)),buttons:[l.Dialog.okButton()]})}}}var R=!1;function H(e,t,a,o,s,r){e.addCommand(t,{label:a,caption:o,execute:async()=>{try{R?(0,l.showErrorMessage)("Another VDK operation is currently running!","Please wait until the operation ends!",[l.Dialog.okButton()]):(R=!0,c.set(n.PATH,K),await async function(){try{const e=await b("job",{body:JSON.stringify(JSON.stringify(u())),method:"POST"});e&&(c.set(n.NAME,e[n.NAME]),c.set(n.TEAM,e[n.TEAM]),c.set(n.PATH,e[n.PATH]))}catch(e){E(e)}}(),r?await s(r):await s(),i(),R=!1)}catch(e){await(0,l.showErrorMessage)("Encountered an error when trying to open the dialog. Error:",e,[l.Dialog.okButton()])}}})}var I=a(280),F=a(123);const U=(e,t)=>{const a=document.createElement("div");a.innerText=String(e),t.classList.contains("jp-vdk-failing-cell")?a.classList.add("jp-vdk-failing-cell-num"):a.classList.add("jp-vdk-cell-num"),t.appendChild(a)},W=e=>{const t=document.createElement("img");t.setAttribute("src","https://raw.githubusercontent.com/vmware/versatile-data-kit/dc15f7489f763a0e0e29370b2e06a714448fc234/support/images/versatile-data-kit-logo.svg"),t.setAttribute("width","20"),t.setAttribute("height","20"),t.classList.add("jp-vdk-logo"),e.appendChild(t)};var V=a(986);let K="";const Y={id:"vdk-jupyterlab-extension:plugin",autoStart:!0,optional:[o.ISettingRegistry,I.IFileBrowserFactory,F.INotebookTracker,l.IThemeManager,V.IDocumentManager],activate:async(e,t,a,n,o,l)=>{const{commands:s}=e;!function(e,t){H(e,"jp-vdk:menu-run","Run","Execute VDK Run Command",C,t),H(e,"jp-vdk:menu-create","Create","Execute VDK Create Command",O),H(e,"jp-vdk:menu-download","Download","Execute VDK Download Command",S),H(e,"jp-vdk:menu-convert-job-to-notebook","Convert Job To Notebook","Convert Data Job To Jupyter Notebook",J),H(e,"jp-vdk:menu-create-deployment","Deploy","Create deployment of a VDK job",_)}(s,l),n.activeCellChanged.connect(((e,t)=>{!function(e){var t,a,n,o;const l=e.currentWidget;if(l){const s=null===(a=null===(t=l.content.model)||void 0===t?void 0:t.contentFactory)||void 0===a?void 0:a.createCodeCell({cell:{cell_type:"code",source:['"""\n',"vdk_ipython extension introduces a magic command for Jupyter.\n","The command enables the user to load VDK for the current notebook.\n","VDK provides the job_input API, which has methods for:\n","    * executing queries to an OLAP database;\n","    * ingesting data into a database;\n","    * processing data into a database.\n","See the IJobInput documentation for more details.\n","https://github.com/vmware/versatile-data-kit/blob/main/projects/vdk-core/src/vdk/api/job_input.py\n","Please refrain from tagging this cell with VDK as it is not an actual part of the data job\n","and is only used for development purposes.\n",'"""\n',"%reload_ext vdk_ipython\n","%reload_VDK\n","job_input = VDK.get_initialized_job_input()"],metadata:{}}}),r=null===(o=null===(n=e.currentWidget)||void 0===n?void 0:n.content.model)||void 0===o?void 0:o.cells,c=null==r?void 0:r.get(0).value.text;r&&s&&r.length<=1&&""==c&&(r.insert(0,s),r.remove(1))}}(n)})),a.defaultBrowser.model.pathChanged.connect(q),((e,t)=>{const a=async()=>{if(e.currentWidget&&e.currentWidget.model&&0!==e.currentWidget.model.cells.length){let a=[],n=0;for(;e.currentWidget&&e.currentWidget.model&&e.currentWidget.model.cells.get(n);){const t=e.currentWidget.model.cells.get(n).metadata.get("tags");t&&t.includes("vdk")&&a.push(n),n++}a.length||(a=await async function(e){try{const t={nbPath:e};return await b("vdkCellIndices",{body:JSON.stringify(t),method:"POST"})}catch(e){E(e)}return[]}(e.currentWidget.context.path)),a.length>0&&e.activeCell&&e.activeCell.parent&&e.activeCell.parent.node.children&&((e,t,a,n)=>{Array.from(document.getElementsByClassName("jp-vdk-cell-num")).forEach((e=>{e.remove()})),Array.from(document.getElementsByClassName("jp-vdk-failing-cell-num")).forEach((e=>{e.remove()})),Array.from(document.getElementsByClassName("jp-vdk-logo")).forEach((e=>{e.remove()}));let o=0;for(let l=0;l<e.length;l++)t.includes(l)?(a.theme&&a.isLight(a.theme.toString())?(e[l].classList.remove("jp-vdk-cell-dark"),e[l].classList.add("jp-vdk-cell")):(e[l].classList.add("jp-vdk-cell"),e[l].classList.add("jp-vdk-cell-dark")),n&&e[l]!=n&&W(e[l]),U(++o,e[l])):(e[l].classList.remove("jp-vdk-cell"),e[l].classList.remove("jp-vdk-cell-dark"))})(Array.from(e.activeCell.parent.node.children),a,t,e.activeCell.node)}};e.activeCellChanged.connect(a),t.themeChanged.connect(a)})(n,o)}},q=async(e,t)=>{K=t.newValue}}}]);